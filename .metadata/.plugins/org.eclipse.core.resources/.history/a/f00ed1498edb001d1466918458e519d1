package comm.octest.servlets;

import java.io.IOException;
import java.sql.SQLException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import comm.octest.beans.Author;
import comm.octest.beans.AuthorFactory;
import comm.octest.beans.Book;
import comm.octest.beans.BookFactory;
import comm.octest.beans.Quote;
import comm.octest.beans.QuoteFactory;
import comm.octest.db.DAO;

@WebServlet(name = "AddQuote", value = "/addQuote")
public class AddQuote extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
   
    public AddQuote() {
        super();
   
    }

	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		this.getServletContext().getRequestDispatcher("/WEB-INF/addQuote.jsp").forward(request, response) ; 
	

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException,SQLException {
	
		HttpSession session =request.getSession () ;
        String email =  (String) session.getAttribute("email") ;
		String name_book = request.getParameter("name_book") ;
		String name_author = request.getParameter("name_author");
		String quote_text = request.getParameter("quote_text") ; 
		String book_type = request.getParameter("book_type") ; 
		
		
		
		
		AuthorFactory author = new AuthorFactory() ; 
		try {
			author.addAuthor(name_author);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		
		
		BookFactory book = new BookFactory() ;
		try {
			book.addBook(name_author,book_type,name_book);
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		DAO pseudo = new DAO() ; 
		try {
			pseudo.getId(email) ;
		} catch (SQLException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		
		int user_id = 1 ;
		QuoteFactory quote = new QuoteFactory() ;
		try {
			quote.addQuote(name_book,quote_text,user_id) ;
		} catch (SQLException e) {
			
			e.printStackTrace();
		}
		
		
		
		
		
		/*try {
			int id_type = pseudo.getType(book_type) ;
			if(id_type < 0) { 
				System.out.print("type non existant");
			}else { 
				Book book = new Book(name_book,id_type) ; 
				int id_book  = pseudo.insertBook(book) ;
				   if(id_book <0 ) { 
						System.out.print("Erreur id book");
				   } else { 
					   Author author = new Author(name_author, id_book) ;
					  int id_author = pseudo.insertAuthor(author) ;
					  if(id_author <0) { 
						  System.out.print("Erreur id book");
					  } else { 
						  SharedQuote sharedQuote = new SharedQuote(id_author,quote_text) ;
						  pseudo.insertQuote(sharedQuote);
						  
					  }
					   
				   }
				
			}*/
			
			
		
		
		
		
		this.getServletContext().getRequestDispatcher("/WEB-INF/addQuote.jsp?success=1").forward(request, response) ; 
		
		
		

		
	}

}
